<div class="container-md">
    <div class="row justify-content-center mx-0">
        <div class="col-md-11 col-xl-10">
            <div class=" card mt-5">
                <div *ngIf="version=='ORIGINAL'" class="display-3 text-center bg-danger rounded-top text-secondary">ORIGINAL</div>
                <div *ngIf="version!='ORIGINAL'&&operationDetail?.operation.passed" class="display-3 text-center bg-success rounded-top text-dark" [ngbPopover]="'Revisión por ' +operationDetail?.operation.admin_name+ ' el '+ operationDetail?.operation.updated_on" popoverTitle="Detalle"
                    [openDelay]="300" [closeDelay]="500" triggers="mouseenter:mouseleave">
                    REVISADA
                </div>
                <div *ngIf="!isLoading; else spinnerBlock" class="px-4 card-header d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <i class="fa-solid fa-list-check fa-4x"></i>
                        <div class="ml-3">
                            <p *ngIf="operationDetail.operation.operation_type=='CLOSE'" class=" display-4 text-uppercase">Cierre de turno</p>
                            <p *ngIf="operationDetail.operation.operation_type=='OPEN'" class=" display-4 text-uppercase">Apertura de turno</p>
                            <p class="h4 mb-1 font-weight-light">{{operationDetail.operation.uname}}</p>
                            <p *ngIf="operationDetail.operation.helper_uname!=null" class="h5 mb-1 font-italic font-weight-light">{{operationDetail.operation.helper_uname}} <strong>(Ayudante)</strong></p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="h3 mb-1 text-muted font-italic font-weight-lighter">Turno {{operationDetail.operation.turn_name}}
                        </div>
                        <div class="h5 mb-1 text-muted font-italic font-weight-lighter">
                            {{operationDetail.operation.timestamp|date:'E d/MM/YYYY, HH:mm'}}hs</div>
                        <div class="h5 mb-1 text-muted">Planilla Nº{{operationDetail.operation.id}}</div>
                    </div>
                </div>
                <div class="card-body">
                    <p class="h4">Registro:</p>
                    <ngb-accordion [closeOthers]="true" activeIds="">
                        <ngb-panel id="pumps">
                            <ng-template ngbPanelTitle>
                                <div *ngIf="!isLoading" class="d-flex align-items-center">
                                    <div class="mx-3">
                                        <p class="text-dark title">
                                            Surtidores</p>
                                    </div>
                                    <div class="mx-5">
                                        <p class="text-muted m-0" style="font-size: larger;">
                                            {{pumpTotalAmount()|currency:'ARS'}}</p>
                                    </div>
                                    <div class="mx-3">
                                        <p class="text-muted m-0" style="font-size: larger;">
                                            {{pumpm3Amount()| number:'1.2-2'}} <small>[m3]</small> </p>
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template ngbPanelContent>
                                <div class="table-responsive">
                                    <table class=" table table-fix-head" id="">
                                        <thead class="thead-dark text-primary">
                                            <tr>
                                                <th class="col-1 col-lg-1 text-center">#</th>
                                                <th class="col-1 d-none d-lg-table-cell">Tipo</th>
                                                <th class="col-2 d-none d-lg-table-cell">Descripción</th>
                                                <th class="col-2 col-lg-3 text-center">Lectura Inicial</th>
                                                <th class="col-2 col-lg-3 text-center">Lectura Final</th>
                                                <th class="col-1 col-lg-1 text-center">Venteo</th>
                                                <th class="col-1 text-center">Vendido</th>
                                                <th class="col-1 d-none d-lg-table-cell text-center">Precio Unitario</th>
                                                <th class="col-1 col-lg-4 text-center">Importe</th>
                                            </tr>
                                        </thead>
                                        <tbody *ngIf="!isLoading">
                                            <tr *ngFor="let item of operationDetail.pumps" [ngClass]="{'bg-primary':!!item.venting||!!item.meter_diff}">
                                                <td class="text-center">{{item.pump_id}}
                                                </td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    {{item.type_name}}</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    {{!item.description?'-':item.description}}</td>
                                                <td class=" text-center">
                                                    {{item.init_meter| number:'1.2-2'}}<small>[{{item.unit}}]</small>
                                                </td>
                                                <td>
                                                    {{+item.init_meter + +item.meter_diff | number:'1.2-2'}}<small>[{{item.unit}}]</small>
                                                </td>
                                                <td>
                                                    {{item.venting??0| number:'1.2-2'}}<small>[{{item.unit}}]</small>
                                                </td>
                                                <td class="text-center">
                                                    <strong>{{item.meter_diff??0|
                                                        number:'1.2-2'}}</strong><small>[{{item.unit}}]</small>
                                                </td>

                                                <td class="d-none d-lg-table-cell text-center">
                                                    {{item.unit_price|currency:'ARS'}}
                                                </td>
                                                <td class=" text-center">{{item.amount_sold??0|currency:'ARS'}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </ng-template>
                        </ngb-panel>
                        <ngb-panel id="gral_meter">
                            <ng-template ngbPanelTitle>
                                <div *ngIf="!isLoading" class="d-flex align-items-center">
                                    <div class="mx-3">
                                        <p class="text-dark title">
                                            Medidor General</p>
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template ngbPanelContent>
                                <div class="table-responsive">
                                    <table class=" table table-fix-head" id="">
                                        <thead class="thead-dark text-primary">
                                            <tr>
                                                <th class="text-center">#</th>
                                                <th class="text-center">Lectura Inicial</th>
                                                <th class="text-center">Diferencia</th>
                                                <th class="text-center">Lectura Final</th>
                                            </tr>
                                        </thead>
                                        <tbody *ngIf="!isLoading">
                                            <tr>
                                                <td>GRAL</td>
                                                <td class="text-center">{{(+operationDetail.gralMeter.accumulated - +operationDetail.gralMeter.meter_diff)>0 ? (+operationDetail.gralMeter.accumulated - +operationDetail.gralMeter.meter_diff) : '0'| number:'1.2-2' }}</td>
                                                <td class="text-center">{{operationDetail.gralMeter.meter_diff | number:'1.2-2'}}
                                                </td>
                                                <td class="text-center">{{+operationDetail.gralMeter.accumulated | number:'1.2-2'}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </ng-template>
                        </ngb-panel>
                        <ngb-panel id="products">
                            <ng-template ngbPanelTitle>
                                <div *ngIf="!isLoading" class="d-flex align-items-center">
                                    <div class="mx-3">
                                        <p class="text-dark title">
                                            Productos</p>
                                    </div>
                                    <div class="mx-5">
                                        <p class="text-muted m-0" style="font-size: larger;">
                                            {{productTotalAmount()|currency:'ARS'}}</p>
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template ngbPanelContent>
                                <div class="table-responsive">
                                    <table class=" table table-fix-head nw-table" id="">
                                        <thead class="thead-dark text-primary">
                                            <tr>
                                                <th class="col-2 col-lg-4">Nombre</th>
                                                <th class="col-1 d-none d-lg-table-cell">Descripción</th>
                                                <th class="col-1 d-none d-lg-table-cell">Categoría</th>
                                                <th class="col-1 text-center">Stock inicial</th>
                                                <th class="col-1 text-center">Vendidos</th>
                                                <th class="col-1 text-center">Repuestos</th>
                                                <th class="col-1 text-center">Stock Final</th>
                                                <th class="col-2 d-none d-lg-table-cell text-center">Precio Unitario</th>
                                                <th class="col-2 text-center">Importe</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody *ngIf="!isLoading">
                                            <tr *ngFor="let item of operationDetail.products" [ngClass]="{'bg-primary':!!item.items_sold||!!item.items_replacement}">
                                                <td [ngClass]="{'scrolling-text':innerItem.offsetWidth>outerItem.clientWidth}" class="set-max-width" style="--mw:90px" #outerItem> <span #innerItem>{{item.name}}</span>
                                                </td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    {{!item.description?'-':item.description}}</td>
                                                <td class="d-none d-lg-table-cell">
                                                    {{item.category??'-'}}
                                                </td>
                                                <td class=" text-center">{{item.init_stock}}</td>
                                                <td class=" text-center">
                                                    {{item.items_sold??0}}
                                                </td>
                                                <td class=" text-center">
                                                    {{item.items_replacement??0}}
                                                </td>
                                                <td class=" text-center">
                                                    {{+item.init_stock + +(item.items_replacement??0) - +(item.items_sold??0)}}
                                                </td>
                                                <td class="d-none d-lg-table-cell text-center">
                                                    {{item.unit_price|currency:'ARS'}}
                                                </td>
                                                <td class=" text-center">{{item.amount_sold??0|currency:'ARS'}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </ng-template>
                        </ngb-panel>
                        <ngb-panel id="accounts">
                            <ng-template ngbPanelTitle>
                                <div *ngIf="!isLoading" class="d-flex align-items-center">
                                    <div class="mx-3">
                                        <p class="text-dark title">
                                            Rendición</p>
                                    </div>
                                    <div class="ml-5">
                                        <p class="text-muted m-0" style="font-size: larger;">
                                            {{accTotalAmount()|currency:'ARS'}}</p>
                                    </div>
                                    <div *ngIf="operationDetail.operation.id_accountancy_bkp!=null" class="mx-3">
                                        <p class="m-0">
                                            <span *ngIf="version!='ORIGINAL'" class="badge badge-warning">Editado por {{operationDetail.operation.admin_name}} el {{operationDetail.operation.updated_on|date:'short'}}</span></p>
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template ngbPanelContent>
                                <div class="table-responsive">
                                    <table *ngIf="!isLoading" class=" table table-fix-head" id="">
                                        <thead class="thead-dark text-primary">
                                            <tr>
                                                <th>Tipo</th>
                                                <th class="d-none d-lg-table-cell">Descripción</th>
                                                <th>Monto</th>
                                            </tr>
                                        </thead>
                                        <tbody *ngIf="accountValid();let acc">
                                            <tr [ngClass]="{'table-success':+acc.envelopes_cash>0}">
                                                <td>Sobres</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">Nº de sobres/Total entregado</td>
                                                <td>
                                                    <div>
                                                        {{acc.n_envelopes}}/{{acc.envelopes_cash|currency:'ARS'}}
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr [ngClass]="{'table-success':+acc.cash>0}">
                                                <td>Efectivo</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    Dinero en efectivo
                                                </td>
                                                <td>{{acc.cash|currency:'ARS'}}
                                                </td>
                                            </tr>
                                            <tr [ngClass]="{'table-success':+acc.envelopes_cash>0}">
                                                <td>Vales</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    Vales entregados
                                                </td>
                                                <td>{{acc.vouchers|currency:'ARS'}}
                                                </td>
                                            </tr>
                                            <tr [ngClass]="{'table-success':+acc.cards>0}">
                                                <td>Tarjetas</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    Crédito/Débito</td>
                                                <td>{{acc.cards|currency:'ARS'}}
                                                </td>
                                            </tr>
                                            <tr [ngClass]="{'table-success':+acc.expenses>0}">
                                                <td>Gastos</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    Retiros
                                                </td>
                                                <td>{{acc.expenses|currency:'ARS'}}
                                                </td>
                                            </tr>
                                            <tr [ngClass]="{'table-success':+acc.MercadoPago>0}">
                                                <td>MPago</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    MercadoPago
                                                </td>
                                                <td>{{acc.MercadoPago|currency:'ARS'}}
                                                </td>
                                            </tr>
                                            <tr [ngClass]="{'table-success':+acc.others>0}">
                                                <td>Otros</td>
                                                <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                                                    Ingreso
                                                </td>
                                                <td>{{acc.others|currency:'ARS'}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </ng-template>
                        </ngb-panel>
                    </ngb-accordion>
                    <div class="p-4">
                        <p class="display-4 text-uppercase text-center text-md-left">Resultado del turno</p>
                        <div *ngIf="!isLoading" class="mt-3 row align-items-center justify-content-center text-center" style="font-size: 1.5em;">
                            <div class="col-xl-3 col-md-5 flex-column ">
                                <p class="font-weight-light text-muted mb-0">Rendición</p>
                                <p class="font-weight-light" style="font-size: 1.7em;">
                                    {{accTotalAmount()|currency:'ARS'}}</p>
                            </div>

                            <div class="col-xl-1 col-md-2">
                                <p class="font-weight-bold" style="font-size: 1.7em;">-</p>
                            </div>
                            <div class="col-xl-3 col-md-5 flex-column">
                                <p class="font-weight-light text-muted mb-0">Ventas</p>
                                <p class="font-weight-light" style="font-size: 1.7em;">
                                    {{productTotalAmount()+pumpTotalAmount()|currency:'ARS'}}</p>
                            </div>

                            <div class="col-md-1">
                                <p class="font-weight-bold" style="font-size: 1.7em;">=</p>
                            </div>
                            <div class="col-xl-3 col-md-5 flex-column">
                                <p class="font-weight-light text-muted mb-0">Diferencia <span class="text-success">S</span>/<span class="text-danger">F</span></p>
                                <p class="font-weight-bold" [ngClass]="{'text-success':accTotalAmount()-(productTotalAmount()+pumpTotalAmount())>0,'text-danger':accTotalAmount()-(productTotalAmount()+pumpTotalAmount())<0}" style="font-size: 1.7em;">
                                    {{accTotalAmount()-(productTotalAmount()+pumpTotalAmount())|currency:'ARS'}}</p>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="!isLoading" class="p-4">
                        <div *ngIf="operationDetail.operation.observations!=''" class="row mt-3">
                            <div class="col">
                                <p class="display-4 text-uppercase text-center text-md-left">Observaciones</p>
                                <p class="font-weight-light text-center text-md-left mb-0">
                                    {{isLoading?'':operationDetail.operation.observations}}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div *ngIf="!isLoading" class="row justify-content-center">
                        <div *ngIf="version!='ORIGINAL'" class="col text-center">
                            <button class="btn btn-simple btn-warning " (click)="editModal(accEdit)"><i
                                    class="fa-solid fa-pen-to-square"></i> Editar Rendición</button>
                        </div>
                        <div class="col text-center">
                            <button class="btn btn-neutral " (click)="print(PrintTemplate)"><i
                                    class="fa-solid fa-print"></i> Imprimir</button>
                        </div>
                        <div *ngIf="!operationDetail?.operation.passed" class="col text-center">
                            <button class="btn btn-success btn-simple " (click)="setPassed()" [disabled]="passedSaving"><i
                                    class="fa-solid fa-check"></i> Marcar Revisada <span *ngIf="passedSaving">
                                        <div class="sk-chase" style="font-size: 1em;margin-left: -1.2em;">
                                            <div class="sk-chase-dot"></div>
                                            <div class="sk-chase-dot"></div>
                                            <div class="sk-chase-dot"></div>
                                            <div class="sk-chase-dot"></div>
                                            <div class="sk-chase-dot"></div>
                                            <div class="sk-chase-dot"></div>
                                        </div>
                                    </span>
                                </button>
                        </div>
                        <div *ngIf="operationDetail.operation.id_accountancy_bkp!=null&&version!='ORIGINAL'" class="col text-center">
                            <button class="btn btn-info " [routerLink]="['/operations/detail',operationDetail.operation.id]" [queryParams]="{version:'ORIGINAL'}"><i
                                    class="fa-solid fa-eye"></i> Ver original</button>
                        </div>
                        <div *ngIf="version=='ORIGINAL'" class="col text-center">
                            <button class="btn btn-info " routerLink="." [queryParams]="{}"><i
                                    class="fa-solid fa-chevron-left"></i> Volver</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <ng-template #spinnerBlock>
        <div class="row py-5">
            <div class="col d-flex align-items-center justify-content-center">
                <div class="sk-chase" style="font-size: 5em;">
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                </div>
            </div>
        </div>
    </ng-template>
    <ng-template #PrintTemplate>
        <div class="white-content" style="background: #fff !important;" *ngIf="!isLoading">
            <h1 class="text-center display-2">Planilla de Turno Nº {{operationDetail.operation.id}}</h1>
            <p *ngIf="version=='ORIGINAL'" class=" display-2 text-center">ORIGINAL</p>
            <p *ngIf="operationDetail.operation.operation_type=='CLOSE'" class=" display-3">CIERRE DE TURNO
            </p>
            <p *ngIf="operationDetail.operation.operation_type=='OPEN'" class=" display-3">APERTURA DE TURNO
            </p>
            <p> <span class="font-weight-bold">Turno:</span> {{operationDetail.operation.turn_name}}</p>
            <p><span class="font-weight-bold">Fecha/Hora:</span> {{operationDetail.operation.timestamp|date:'E d/MM/YYYY, HH:mm'}}hs
            </p>
            <p><span class="font-weight-bold">Encargado:</span> {{operationDetail.operation.uname}}</p>
            <p><span class="font-weight-bold">Ayudante:</span> {{operationDetail.operation.helper_uname??'-'}}</p>
            <p><span class="font-weight-bold">Observaciones:</span> {{operationDetail.operation.observations}}</p>
            <p *ngIf="operationDetail.operation.id_accountancy_bkp!=null&&version!='ORIGINAL'"><span class="font-weight-bold">Editado por:</span> {{operationDetail.operation.admin_name}} el {{operationDetail.operation.updated_on|date:'medium'}}</p>
            <p class="display-4 font-weight-bold pt-4">REGISTRO:</p>
            <p class="display-4">Surtidores</p>
            <table class=" table table-bordered">
                <thead>
                    <tr>
                        <th class="text-center">#</th>
                        <th class="d-none d-lg-table-cell">Tipo</th>
                        <th class="d-none d-lg-table-cell">Descripción</th>
                        <th class="text-center">Lectura Inicial</th>
                        <th class="text-center">Lectura Final</th>
                        <th class="text-center">Venteo</th>
                        <th class="text-center">Vendido</th>
                        <th class="d-none d-lg-table-cell text-center">Precio Unitario</th>
                        <th class=" text-center">Importe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of operationDetail.pumps">
                        <td class="text-center">{{item.pump_id}}
                        </td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            {{item.type_name}}</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            {{!item.description?'-':item.description}}</td>
                        <td class=" text-center">
                            {{item.init_meter| number:'1.2-2'}}<small>[{{item.unit}}]</small>
                        </td>
                        <td>
                            {{+item.init_meter + +item.meter_diff | number:'1.2-2'}}<small>[{{item.unit}}]</small>
                        </td>
                        <td>
                            {{item.venting??0| number:'1.2-2'}}<small>[{{item.unit}}]</small>
                        </td>
                        <td class="text-center">
                            <strong>{{item.meter_diff??0|
                                number:'1.2-2'}}</strong><small>[{{item.unit}}]</small>
                        </td>

                        <td class="d-none d-lg-table-cell text-center">
                            {{item.unit_price|currency:'ARS'}}
                        </td>
                        <td class=" text-center">{{item.amount_sold??0|currency:'ARS'}}
                        </td>
                    </tr>
                </tbody>
            </table>
            <p class="display-4 pt-4 ">Medidor General</p>
            <table class=" table table-bordered" id="">
                <thead>
                    <tr>
                        <th class="text-center">#</th>
                        <th class="text-center">Lectura Inicial</th>
                        <th class="text-center">Diferencia</th>
                        <th class="text-center">Lectura Final</th>
                    </tr>
                </thead>
                <tbody *ngIf="!isLoading">
                    <tr>
                        <td>GRAL</td>
                        <td class="text-center">{{(+operationDetail.gralMeter.accumulated - +operationDetail.gralMeter.meter_diff)>0 ? (+operationDetail.gralMeter.accumulated - +operationDetail.gralMeter.meter_diff) : '0'| number:'1.2-2' }}</td>
                        <td class="text-center">{{operationDetail.gralMeter.meter_diff | number:'1.2-2'}}
                        </td>
                        <td class="text-center">{{operationDetail.gralMeter.accumulated| number:'1.2-2'}}</td>
                    </tr>
                </tbody>
            </table>
            <p class="display-4 pt-4 ">Productos</p>
            <table class=" table table-bordered" id="">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th class="d-none d-lg-table-cell">Descripción</th>
                        <th class="d-none d-lg-table-cell">Categoría</th>
                        <th class="text-center">Stock inicial</th>
                        <th class="text-center">Vendidos</th>
                        <th class="text-center">Repuestos</th>
                        <th class="text-center">Stock Final</th>
                        <th class="d-none d-lg-table-cell text-center">Precio Unitario</th>
                        <th class=" text-center">Importe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of operationDetail.products">
                        <td class="cell-ellipsis" style="--mw:90px;">{{item.name}}
                        </td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            {{!item.description?'-':item.description}}</td>
                        <td class="d-none d-lg-table-cell">
                            {{item.category??'-'}}
                        </td>
                        <td class=" text-center">{{item.init_stock}}</td>
                        <td class=" text-center">
                            {{item.items_sold??0}}
                        </td>
                        <td class=" text-center">
                            {{item.items_replacement??0}}
                        </td>
                        <td class=" text-center">
                            {{+item.init_stock + +(item.items_replacement??0) - +(item.items_sold??0) }}
                        </td>
                        <td class="d-none d-lg-table-cell text-center">
                            {{item.unit_price|currency:'ARS'}}
                        </td>
                        <td class=" text-center">{{item.amount_sold??0|currency:'ARS'}}
                        </td>
                    </tr>
                </tbody>
            </table>
            <p class="display-4 pt-4 ">Rendición</p>
            <table class=" table table-bordered" id="">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th class="d-none d-lg-table-cell">Descripción</th>
                        <th>Monto</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Sobres</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">Nº de sobres/Total entregado</td>
                        <td>
                            <div>
                                {{operationDetail.accountancy.n_envelopes}}/{{operationDetail.accountancy.envelopes_cash|currency:'ARS'}}
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>Efectivo</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            Dinero en efectivo
                        </td>
                        <td>{{operationDetail.accountancy.cash|currency:'ARS'}}
                        </td>
                    </tr>
                    <tr>
                        <td>Vales</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            Vales entregados
                        </td>
                        <td>{{operationDetail.accountancy.vouchers|currency:'ARS'}}
                        </td>
                    </tr>
                    <tr>
                        <td>Tarjetas</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            Crédito/Débito</td>
                        <td>{{operationDetail.accountancy.cards|currency:'ARS'}}
                        </td>
                    </tr>
                    <tr>
                        <td>Gastos</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            Retiros
                        </td>
                        <td>{{operationDetail.accountancy.expenses|currency:'ARS'}}
                        </td>
                    </tr>
                    <tr>
                        <td>MPago</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            MercadoPago
                        </td>
                        <td>{{operationDetail.accountancy.MercadoPago|currency:'ARS'}}
                        </td>
                    </tr>
                    <tr>
                        <td>Otros</td>
                        <td class="cell-ellipsis d-none d-lg-table-cell" style="--mw:150px;">
                            Ingreso
                        </td>
                        <td>{{operationDetail.accountancy.others|currency:'ARS'}}
                        </td>
                    </tr>
                </tbody>
            </table>
            <p class="display-4 text-uppercase text-center text-md-left mt-3">Resultado del turno</p>
            <div class="mt-3 row align-items-center justify-content-center text-center" style="font-size: 1.5em;">
                <div class="col-xl-3 col-md-5 flex-column ">
                    <p class="font-weight-light text-muted mb-0">Rendición</p>
                    <p class="font-weight-light" style="font-size: 1.7em;">
                        {{accTotalAmount()|currency:'ARS'}}</p>
                </div>

                <div class="col-xl-1 col-md-2">
                    <p class="font-weight-bold" style="font-size: 1.7em;">-</p>
                </div>
                <div class="col-xl-3 col-md-5 flex-column">
                    <p class="font-weight-light text-muted mb-0">Ventas</p>
                    <p class="font-weight-light" style="font-size: 1.7em;">
                        {{productTotalAmount()+pumpTotalAmount()|currency:'ARS'}}</p>
                </div>

                <div class="col-md-1">
                    <p class="font-weight-bold" style="font-size: 1.7em;">=</p>
                </div>
                <div class="col-xl-3 col-md-5 flex-column">
                    <p class="font-weight-light text-muted mb-0">Diferencia S/F</p>
                    <p class="font-weight-bold" style="font-size: 1.7em;">
                        {{accTotalAmount()-(productTotalAmount()+pumpTotalAmount())|currency:'ARS'}}</p>
                </div>
            </div>

        </div>
    </ng-template>

    <ng-template #accEdit let-modal>
        <div class="modal-header">
            <h3 class="modal-title">Editando rendición #{{operationDetail.operation.id}}</h3>
            <button type="button" class="btn-close btn btn-link" aria-label="Close" (click)="modal.dismiss('Cross click')">X</button>
        </div>
        <div class="modal-body text-center">
            <form #acc="ngForm">
                <table class=" table table-fix-head" id="">
                    <thead class="thead-dark text-primary">
                        <tr>
                            <th>Tipo</th>
                            <th>Monto</th>
                        </tr>
                    </thead>
                    <tbody *ngIf="!isLoading">
                        <tr [ngClass]="{'table-danger':(n_envelopes.touched||envelopes$.touched)&&(n_envelopes.invalid||envelopes$.invalid),'table-success':(n_envelopes.valid&&envelopes$.valid)}">
                            <td>Sobres</td>
                            <td>
                                <div class="row justify-content-center">
                                    <input #n_envelopes="ngModel" name="n_envelopes" inputmode="numeric" type="number" min="0" class="form-control col-3" [ngModel]="operationDetail.accountancy.n_envelopes" placeholder="NºSobres" ngModel required>
                                    <input #envelopes$="ngModel" name="envelopes_cash" inputmode="numeric" type="number" min="0" class="form-control col-8" [ngModel]="operationDetail.accountancy.envelopes_cash" placeholder="$" ngModel required>
                                </div>
                            </td>
                        </tr>
                        <tr [ngClass]="{'table-danger':cash.touched&&cash.invalid,'table-success':cash.valid}">
                            <td>Efectivo</td>
                            <td><input #cash="ngModel" name="cash" inputmode="numeric" type="number" min="0" class="form-control" [ngModel]="operationDetail.accountancy.cash" ngModel required>
                            </td>
                        </tr>
                        <tr [ngClass]="{'table-danger':vouchers.touched&&vouchers.invalid,'table-success':vouchers.valid}">
                            <td>Vales</td>
                            <td><input #vouchers="ngModel" name="vouchers" inputmode="numeric" type="number" min="0" class="form-control" [ngModel]="operationDetail.accountancy.vouchers" ngModel required>
                            </td>
                        </tr>
                        <tr [ngClass]="{'table-danger':cards.touched&&cards.invalid,'table-success':cards.valid}">
                            <td>Tarjetas</td>
                            <td><input #cards="ngModel" name="cards" inputmode="numeric" type="number" min="0" class="form-control" [ngModel]="operationDetail.accountancy.cards" ngModel required>
                            </td>
                        </tr>
                        <tr [ngClass]="{'table-danger':expenses.touched&&expenses.invalid,'table-success':expenses.valid}">
                            <td>Gastos</td>
                            <td><input #expenses="ngModel" name="expenses" inputmode="numeric" type="number" min="0" class="form-control" [ngModel]="operationDetail.accountancy.expenses" ngModel required>
                            </td>
                        </tr>
                        <tr [ngClass]="{'table-danger':MPago.touched&&MPago.invalid,'table-success':MPago.valid}">
                            <td>MPago</td>
                            <td><input #MPago="ngModel" name="MercadoPago" inputmode="numeric" type="number" min="0" class="form-control" [ngModel]="operationDetail.accountancy.MercadoPago" ngModel required>
                            </td>
                        </tr>
                        <tr [ngClass]="{'table-danger':others.touched&&others.invalid,'table-success':others.valid}">
                            <td>Otros</td>
                            <td><input #others="ngModel" name="others" inputmode="numeric" type="number" min="0" class="form-control" [ngModel]="operationDetail.accountancy.others" ngModel required>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
        </div>
        <div class="row justify-content-center">
            <div class="input-group input-group-lg col-10">
                <div class="input-group-prepend">
                    <span style="position: relative !important;top: 0px !important;left: 0px !important;" [ngClass]="{'border-warning':acc.invalid||adminPass.invalid}" class="input-group-text" id="pininp">Contraseña de Admin</span>
                </div>
                <input [ngClass]="{'is-invalid':acc.invalid||adminPass.invalid}" #adminPass="ngModel" type="password" class="form-control text-center" placeholder="--------" required ngModel>
                <div class="invalid-tooltip">
                    {{acc.invalid?'Planilla incompleta':'Ingrese pin'}}
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="modal.dismiss('Cerrar')">Cerrar</button>
            <button type="button" class="btn btn-success btn-simple" (click)="submitAcc(acc.value,adminPass.value)" [disabled]="acc.invalid||adminPass.invalid||saving">{{saving?'':'Guardar'}}<span style="min-width: 4em;" [ngClass]="{'d-none':!saving}">
                <div class="sk-chase" style="font-size: 1em;margin-left: -1.2em;">
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                </div>
            </span></button>
        </div>
    </ng-template>