<div class=" content">
    <div class="row d-md-columns">
        <div *ngIf="isLoading" class="col-12 text-center p-4">
            <div class="sk-chase" style="font-size: 5em;">
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
            </div>
        </div>
        <div *ngIf="!isLoading" class="col-12 d-md-inline-block">
            <div class="card">
                <div class="card-header">
                    <div class="display-2">
                        Datos de Sucursal
                    </div>
                </div>
                <div class="card-body">
                    <form #localForm="ngForm" (submit)="passModal(pModal,localForm.value, 'LOCAL')" [ngClass]="{'was-validated':localForm.invalid&&localForm.touched}">
                        <div class="form-group">
                            <label for="local_name">Nombre</label>
                            <input type="text" name="LOCAL_NAME" class="form-control" id="local_name" aria-describedby="localName" [ngModel]="company.LOCAL_NAME" required>
                            <div class="invalid-tooltip">
                                Campo requerido
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="local_address">Dirección</label>
                            <input type="text" name="LOCAL_ADDRESS" [ngModel]="company.LOCAL_ADDRESS" class="form-control" id="local_address" aria-describedby="localName" required>
                            <div class="invalid-tooltip">
                                Campo requerido
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="local_mail">Email de contacto</label>
                            <input type="email" name="COMPANY_MAIL" class="form-control" id="COMPANY_MAIL" [ngModel]="company.COMPANY_MAIL" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" aria-describedby="localMail" required>
                            <div class="invalid-tooltip">
                                Campo requerido
                            </div>
                        </div>
                        <div class="text-right">
                            <button type="submit" class="btn btn-neutral" [disabled]="localForm.pristine||localForm.invalid">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div *ngIf="!isLoading" class="col-12 d-md-inline-block">
            <div class="card">
                <div class="card-header">
                    <div class="display-2">
                        Facturación Automática
                    </div>
                </div>
                <div class="card-body">
                    <form #autoForm="ngForm" (submit)="passModal(pModal,autoForm.value, 'AUTO')" [ngClass]="{'was-validated':autoForm.invalid&&autoForm.touched}">
                        <div class="form-group">
                            <label for="auto_max_amount">Monto máximo por factura</label>
                            <input type="number" inputmode="numeric" name="AI_MAX_AMOUNT" class="form-control" id="auto_max_amount" aria-describedby="auto_max_amount" [ngModel]="auto.AI_MAX_AMOUNT" required>
                            <div class="invalid-tooltip">
                                Campo requerido. Solo valores numéricos.
                            </div>
                        </div>
                        <div class="card-header pt-0">
                            <h4 class="m-0">Surtidores</h4>
                        </div>
                        <div class="border border-light rounded p-3 m-1">
                            <div class="form-group">
                                <label for="pumps_percent">Porcentaje a facturar</label>
                                <input type="number" inputmode="numeric" name="AI_PUMPS_INV_RATIO" [ngModel]="auto.AI_PUMPS_INV_RATIO" class="form-control" id="pumps_percent" aria-describedby="pumps_percent" required>
                                <div class="invalid-tooltip">
                                    Sólo se admiten números entre 5 y 100
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="pump_min_threshold">Monto mínimo requerido para emitir factura</label>
                                <input type="number" inputmode="numeric" name="AI_PUMPS_INV_MIN_THRESHOLD" [ngModel]="auto.AI_PUMPS_INV_MIN_THRESHOLD" class="form-control" id="pump_min_threshold" required>
                                <div class="invalid-tooltip">
                                    Campo requerido. Solo valores numéricos.
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="auto_max_amount">IVA</label>
                                <select name="AI_PUMPS_ALIQUOT_TYPE" class="custom-select" id="aliquot" required [ngModel]="auto.AI_PUMPS_ALIQUOT_TYPE">
                                    <option selected disabled value="" hidden>Seleccionar</option>
                                    <option *ngFor="let a of aliquots" [value]="a.Id">{{a.Desc}}</option>
                                  </select>

                                <div class="invalid-tooltip">
                                    Campo requerido.
                                </div>
                            </div>
                        </div>
                        <div class="card-header">
                            <h4 class="m-0">Productos</h4>
                        </div>
                        <div class="border border-light rounded p-3 m-1">
                            <div class="form-group">
                                <label for="prod_percent">Porcentaje a facturar</label>
                                <input type="number" inputmode="numeric" name="AI_PROD_INV_RATIO" [ngModel]="auto.AI_PROD_INV_RATIO" class="form-control" id="prod_percent" aria-describedby="prod_percent" required>
                                <div class="invalid-tooltip">
                                    Sólo se admiten números entre 5 y 100
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="prod_min_threshold">Monto mínimo requerido para emitir factura</label>
                                <input type="number" inputmode="numeric" name="AI_PROD_INV_MIN_THRESHOLD" [ngModel]="auto.AI_PROD_INV_MIN_THRESHOLD" class="form-control" id="prod_min_threshold" required>
                                <div class="invalid-tooltip">
                                    Campo requerido. Solo valores numéricos.
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="auto_max_amount">IVA</label>
                                <select name="AI_PROD_ALIQUOT_TYPE" class="custom-select" id="aliquot" required [ngModel]="auto.AI_PROD_ALIQUOT_TYPE">
                                <option selected disabled value="" hidden>Seleccionar</option>
                                <option *ngFor="let a of aliquots" [value]="a.Id">{{a.Desc}}</option>
                              </select>

                                <div class="invalid-tooltip">
                                    Campo requerido.
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <button type="submit" class="btn btn-neutral" [disabled]="autoForm.pristine||autoForm.invalid">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div *ngIf="!isLoading" class="col-12 d-md-inline-block">
            <div class="card">
                <div class="card-header">
                    <div class="display-2">
                        Datos Fiscales
                    </div>
                </div>
                <div class="card-body">
                    <form #fiscalForm="ngForm" (submit)="passModal(pModal,fiscalForm.value,'FISCAL')" [ngClass]="{'was-validated':fiscalForm.invalid&&fiscalForm.touched}">
                        <div class="form-group">
                            <label for="sales_point">Punto de venta</label>
                            <input type="number" inputmode="numeric" name="SALES_POINT" class="form-control" id="sales_point" aria-describedby="salesPoint" [ngModel]="afip.SALES_POINT" required>
                            <div class="invalid-tooltip">
                                Campo requerido. Solo valores numéricos.
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="condition">Condición Fiscal</label>
                            <input type="text" name="FISCAL_CONDITION" class="form-control" id="condition" aria-describedby="condition" [ngModel]="afip.FISCAL_CONDITION" required>
                            <div class="invalid-tooltip">
                                Campo requerido
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cuit">CUIT</label>
                            <input type="text" name="CUIT" class="form-control-plaintext" id="cuit" aria-describedby="cuit" pattern="[0-9]{2}-[0-9]{8}-[0-9]{1}" [ngModel]="afip.CUIT" readonly required>
                            <div class="valid-tooltip">
                                Solo puede ser cambiado por administrador
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="iibb">Ingresos Brutos</label>
                            <input type="text" name="IIBB" class="form-control" id="iibb" aria-describedby="iibb" [ngModel]="afip.IIBB" required>
                            <div class="invalid-tooltip">
                                Campo requerido
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="auto_max_amount">IVA</label>
                            <select name="ALIQUOT_TYPE_SELECTED" class="custom-select" id="aliquot" required [ngModel]="afip.ALIQUOT_TYPE_SELECTED">
                                <option selected disabled value="" hidden>Seleccionar</option>
                                <option *ngFor="let a of aliquots" [value]="a.Id">{{a.Desc}}</option>
                              </select>

                            <div class="invalid-tooltip">
                                Campo requerido.
                            </div>
                        </div>
                        <div class="d-flex flex-column pt-2">
                            <p>Facturación habilitada en playa:</p>
                            <ng-template ngFor let-voucher [ngForOf]="vouchers" let-i="index">
                                <div class="form-check-inline">
                                    <input class="form-check-input" type="checkbox" (change)="setVoucher($event.target,voucher.Id)" [checked]="vouchersAllowed.has(voucher.Id)" [id]="'check-'+i">
                                    <label class="form-check-label" [for]="'check-'+i">
                                          {{voucher.Desc}}
                                        </label>
                                </div>
                            </ng-template>
                        </div>
                        <div class="text-right">
                            <button type="submit" class="btn btn-neutral" [disabled]="!((fiscalForm.dirty&&fiscalForm.valid)||vaTouched)">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #pModal let-conf>
    <div class="modal-header">
        <h3 class="modal-title"><i class="fa-solid fa-triangle-exclamation text-warning"></i> Advertencia</h3>
        <button type="button" class="btn-close btn btn-link" aria-label="Close" (click)="conf.dismiss('Cross click')">X</button>
    </div>
    <div class="modal-body">
        <p class="bg-warning text-dark p-3"> <strong>¡Esta acción es irreversible!</strong><br>¿Está seguro de los cambios realizados? Ingrese su contraseña de administrador para confirmar.
        </p>
        <div class="input-group mb-3">
            <span class="input-group-text" id="inputGroup-sizing-default"><small>Contraseña de administrador:</small></span>
            <input #passInput type="password" class="form-control" minlength="8" aria-describedby="inputGroup-sizing-default" (input)="saveButt.disabled=!passInput.validity.valid" required>
        </div>
    </div>
    <div class="modal-footer">
        <button #saveButt type="button" class="btn btn-simple btn-danger" (click)="conf.close(passInput.value)" disabled>Guardar</button>
        <button type="button" class="btn btn-primary" (click)="conf.dismiss('Cancel')">Cancelar</button>
    </div>
</ng-template>